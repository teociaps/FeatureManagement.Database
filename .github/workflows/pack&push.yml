name: Pack & Push

on:
  release:
    types: [published]

env:
  CONFIGURATION: 'Release'
  PACKAGE_OUTPUT: ${{ github.workspace }}/artifacts
  NUGET_SOURCE_URL: 'https://api.nuget.org/v3/index.json'

jobs:
  deploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        dotnet_version: ['6.0.x', '8.0.x']

    steps:
      - uses: actions/checkout@v4
        with:
          sparse-checkout: |
            .github
            src
            build
      - name: .NET setup
        uses: ./.github/actions/dotnet-setup
        with:
          dotnet_version: ${{ matrix.dotnet_version }}

      - name: Pack & Push to NuGet
        shell: pwsh
        run: ./pack&push.ps1 -Configuration ${{ env.CONFIGURATION }} -PackageOutput ${{ env.PACKAGE_OUTPUT }} -NuGetSourceUrl ${{ env.NUGET_SOURCE_URL }} -NuGetApiKey ${{ secrets.NUGET_API_KEY }}